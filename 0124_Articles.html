<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Secret Articles | GHOST.ouo</title>
    <link rel="icon" type="image/png" href="PNG/pixelS2.png">
    <link rel="apple-touch-icon" href="PNG/pixelS2.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="0124_style.css">
    <script src="tailwind.config.js"></script>
    <script type="module" src="0124_main.js" defer></script>
</head>

<body class="font-sans selection:bg-accent-purple/30 selection:text-white">

    <div class="fixed inset-0 z-0 pointer-events-none">
        <div class="absolute inset-0 dot-pattern opacity-50"></div>
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-600/10 rounded-full blur-[120px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <div id="navbar-placeholder"></div>

<main class="relative z-10 max-w-7xl mx-auto px-8 md:px-12 pt-32 pb-24">
        
        <div class="mb-12 relative z-20 pointer-events-none">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-2 leading-tight tracking-tight text-gradient text-left w-fit">
                Articles
            </h1>
            <p class="text-purple-400 font-mono text-xs uppercase tracking-wider">
                Code, Design & Everything in between.
            </p>
        </div>

        <div id="project-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
        </div>
        
    </main>

    <div id="footer-placeholder"></div>

    <script>
    // 關鍵修復：必須加上 async 才能在裡面用 await
    document.addEventListener('DOMContentLoaded', async () => {
        const container = document.getElementById('project-container');
        if (!container) return;

        try {
            // 1. 讀取 JSON 清單 (確保檔名與路徑正確)
            const listResponse = await fetch('0124_articles.json');
            if (!listResponse.ok) throw new Error('無法取得專案清單');
            const articles = (await listResponse.json()).reverse();

            // 2. 使用 Promise.all 同步抓取所有文章內文，效率最高
            await Promise.all(articles.map(async (article) => {
                const card = document.createElement('a');
                card.href = article.url;
                // 初始化為隱身狀態，等動畫啟動
                card.className = 'project-card-vertical group block opacity-0 translate-y-[30px]';
                card.innerHTML = `
                    <div class="relative aspect-video overflow-hidden rounded-t-3xl bg-white/5">
                        <img src="" alt="Loading..." class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                    </div>
                    <div class="p-8 flex flex-col flex-grow text-left">
                        <div class="tag-box flex gap-2 mb-4"></div>
                        <h4 class="text-xl font-bold text-white mb-3 group-hover:text-accent-purple transition-colors">載入中...</h4>
                        <p class="text-gray-400 text-sm leading-normal line-clamp-3"></p>
                    </div>
                `;
                container.appendChild(card);

                // 呼叫爬蟲函數填入資料
                await fetchAndFillCard(card, article.url);
            }));

            // 3. 核心修正：資料抓完後，才執行動畫偵測
            if (typeof window.refreshAnimations === 'function') {
                window.initAnimations();
            }

        } catch (error) {
            console.error("articles 初始化失敗:", error);
        }
    });

    async function fetchAndFillCard(card, url) {
        try {
            const response = await fetch(url);
            const htmlText = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlText, 'text/html');

            // 抓取標題
            const titleEl = doc.querySelector('header h1');
            if (titleEl) card.querySelector('h4').textContent = titleEl.innerText.trim();

            // 抓取圖片並修正路徑 (移除 ../)
            const firstImg = doc.querySelector('article img') || doc.querySelector('figure img');
            if (firstImg) {
                let imgSrc = firstImg.getAttribute('src');
                if (imgSrc && imgSrc.startsWith('../')) imgSrc = imgSrc.substring(3);
                card.querySelector('img').src = imgSrc;
            }

            // 抓取標籤
            const sourceTags = doc.querySelectorAll('header .flex.gap-3 span');
            const cardTagBox = card.querySelector('.tag-box');
            if (sourceTags.length > 0 && cardTagBox) {
                cardTagBox.innerHTML = '';
                sourceTags.forEach(tag => {
                    const newTag = document.createElement('span');
                    newTag.className = tag.className;
                    newTag.textContent = tag.textContent.trim();
                    cardTagBox.appendChild(newTag);
                });
            }

            // 抓取摘要
            const summaryEl = doc.querySelector('article .text-xl') || doc.querySelector('article p');
            if (summaryEl) card.querySelector('p').textContent = summaryEl.innerText.trim();

        } catch (err) {
            console.warn(`文章抓取失敗: ${url}`, err);
        }
    }
</script>

</body>
</html>